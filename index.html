<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Igreja - Galeria & Admin</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- SheetJS for Excel import -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    body { font-family: 'Poppins', sans-serif; background:#f4f1ee; color:#111827; }
    .hero { background: linear-gradient(135deg, rgba(244,241,238,0.9), rgba(126,86,182,0.2)), url('https://i.pinimg.com/736x/d2/69/0a/d2690a7428ca8b7291ea2e74aa5c4202.jpg'); background-size:cover; background-position:center; }
    .masonry { column-gap:1rem; width:100%; }
    @media (min-width:640px) { .masonry { column-count:2; } }
    @media (min-width:1024px) { .masonry { column-count:3; } }
    .masonry-item { display:inline-block; width:100%; margin:0 0 1rem; break-inside:avoid; background:white; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); overflow:hidden; }
    .masonry-item img { width:100%; height:auto; display:block; }
    .album-card { width:220px; background:white; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.06); overflow:hidden; cursor:pointer; transition:transform .15s; }
    .album-card:hover { transform:translateY(-6px); }
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:80; padding:1rem; }
    .modal-content { max-width:1100px; width:100%; max-height:90vh; overflow:auto; border-radius:12px; background:white; padding:1rem; }
    .admin-badge { position:fixed; right:1rem; bottom:1rem; background:#111827; color:white; padding:8px 12px; border-radius:999px; z-index:90; display:none; font-weight:600; box-shadow:0 8px 20px rgba(0,0,0,0.2); }
  </style>
</head>
<body>

  <!-- LOGIN MODAL (visible) -->
  <div id="loginModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-90">
    <div class="bg-white rounded-xl shadow-xl p-6 w-[360px]">
      <h2 class="text-xl font-bold mb-2 text-center">Acesso do Administrador</h2>
      <p class="text-sm text-gray-600 mb-4 text-center">Insira a senha para ativar o modo administrador.</p>
      <input id="adminPasswordInput" type="password" placeholder="Senha do admin" class="w-full p-3 border rounded mb-4" />
      <div class="flex gap-3">
        <button id="adminLoginBtn" class="flex-1 bg-blue-600 text-white p-2 rounded font-semibold">Entrar</button>
        <button id="adminCloseBtn" class="flex-1 bg-gray-100 p-2 rounded">Fechar</button>
      </div>
      <p class="text-xs text-gray-500 mt-3">Senha padrão: <code>admin123</code> (mude no script se desejar)</p>
    </div>
  </div>

  <!-- ADMIN BADGE + LOGOUT -->
  <div id="adminBadge" class="admin-badge flex items-center gap-3">
    <span>ADMIN</span>
    <button id="btnAdminLogout" class="bg-red-600 text-white px-2 py-1 rounded text-sm">Logout</button>
  </div>

  <!-- Header -->
  <header class="bg-white sticky top-0 z-50 shadow-sm">
    <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
      <a href="#" class="flex items-center gap-3"><img src="logo.png" alt="logo" class="h-12"><span class="font-bold text-lg">IEQ Olaria II</span></a>
      <div class="hidden md:flex items-center gap-6">
        <a href="#sobre" class="text-gray-700 hover:text-red-600">Sobre</a>
        <a href="#doutrina" class="text-gray-700 hover:text-red-600">Doutrina</a>
        <a href="#horarios" class="text-gray-700 hover:text-red-600">Programação</a>
        <a href="#galeria" class="text-gray-700 hover:text-red-600">Galeria</a>
        <a id="navMembros" href="#membros" class="text-gray-700 hover:text-red-600 hidden">Membros</a>
        <a href="#contato" class="text-gray-700 hover:text-red-600">Contato</a>
        <a href="https://www.instagram.com/ieqolaria2/" target="_blank" class="bg-gradient-to-r from-pink-500 to-orange-400 text-white px-3 py-2 rounded-full"><i class="fab fa-instagram mr-2"></i>@ieqolaria2</a>
      </div>
      <div class="md:hidden">
        <button id="mobileMenuBtn" class="text-gray-700"><i class="fas fa-bars fa-2x"></i></button>
      </div>
    </nav>
    <div id="mobileMenu" class="hidden md:hidden bg-white border-t">
      <a href="#sobre" class="block px-6 py-3">Sobre</a>
      <a href="#doutrina" class="block px-6 py-3">Doutrina</a>
      <a href="#horarios" class="block px-6 py-3">Programação</a>
      <a href="#galeria" class="block px-6 py-3">Galeria</a>
      <a id="mobileNavMembros" href="#membros" class="block px-6 py-3 hidden">Membros</a>
      <a href="#contato" class="block px-6 py-3">Contato</a>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero py-24 text-center">
    <div class="container mx-auto px-6">
      <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 mb-4">Bem-vindo à IEQ Olaria II</h1>
      <p class="text-lg md:text-xl text-gray-800">Venha nos visitar e fazer parte da nossa família.</p>
    </div>
  </section>

  <main class="container mx-auto px-6 pb-12">

    <!-- Sobre -->
    <section id="sobre" class="py-16">
      <div class="container mx-auto px-6">
         <h2 class="text-2xl font-bold mb-2">Sobre Nossa Igreja</h2>
        <p class="section-subtitle">Conheça um pouco da nossa história e da nossa missão.</p>
        <div class="grid md:grid-cols-2 gap-10 items-center">
          <img src="logo.png" alt="Comunidade" class="rounded-2xl shadow-2xl w-full object-cover">
          <div class="text-lg text-gray-700 space-y-4">
            <p>A Igreja do Evangelho do Evangelho Quadrangular, sede de Timóteo, é uma igreja cheia de vida e acolhedora, dedicada a comunicar o evangelho de Jesus Cristo...</p>
            <p>Liderados pelos nossos pastores Deywson e Sônia Andrade, buscamos ser um farol de esperança...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Doutrina (resumido) -->
    <section id="doutrina" class="py-8 bg-white rounded-lg p-6 shadow-sm">
      <h2 class="text-2xl font-bold text-center mb-2">Doutrina Quadrangular</h2>
      <p class="section-subtitle text-center">Nossa fé é fundamentada em quatro pilares essenciais.</p>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
          <div class="p-6 bg-white rounded-2xl shadow-lg text-center">
            <i class="fas fa-cross text-4xl mb-4 text-red-600"></i>
            <h3 class="font-bold text-xl mb-2">Jesus Salva</h3>
            <p class="text-gray-600">Cremos que Jesus Cristo morreu na cruz para nos salvar...</p>
          </div>
          <div class="p-6 bg-white rounded-2xl shadow-lg text-center">
            <i class="fas fa-dove text-4xl mb-4 text-yellow-500"></i>
            <h3 class="font-bold text-xl mb-2">Jesus Batiza</h3>
            <p class="text-gray-600">Cremos no batismo com o Espírito Santo...</p>
          </div>
          <div class="p-6 bg-white rounded-2xl shadow-lg text-center">
            <i class="fas fa-solid fa-trophy text-4xl mb-4 text-blue-400"></i>
            <h3 class="font-bold text-xl mb-2">Jesus Cura</h3>
            <p class="text-gray-600">Cremos que Jesus tem o poder de curar...</p>
          </div>
          <div class="p-6 bg-white rounded-2xl shadow-lg text-center">
            <i class="fas fa-crown text-4xl mb-4 text-indigo-600"></i>
            <h3 class="font-bold text-xl mb-2">Jesus Voltará</h3>
            <p class="text-gray-600">Cremos na segunda vinda de Jesus...</p>
          </div>
        </div>
    </section>

    <!-- Programação da semana (visível para todos), mas CRUD apenas admin -->
    <section id="horarios" class="py-8 mt-6">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h2 class="text-2xl font-bold">Programação da Semana</h2>
          <p class="text-sm text-gray-600">Veja os eventos semanais</p>
        </div>
        <div id="programAdminControls" class="hidden">
          <button id="btnCreateProgram" class="bg-green-600 text-white px-3 py-2 rounded mr-2">Criar Evento</button>
        </div>
      </div>

      <div id="programList" class="grid md:grid-cols-2 gap-4"></div>
    </section>

    <!-- Galeria -->
    <section id="galeria" class="py-8 bg-white rounded-lg p-6 shadow-sm mt-6">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h2 class="text-2xl font-bold">Mural de Fotos</h2>
          <p class="text-sm text-gray-600">Álbuns e registros</p>
        </div>
        <div id="albumsAdminControls" class="hidden">
          <button id="btnCreateAlbum" class="bg-green-600 text-white px-3 py-2 rounded mr-2">Criar Álbum</button>
          <button id="btnSampleAlbums" class="bg-indigo-600 text-white px-3 py-2 rounded">Popular (ex.)</button>
        </div>
      </div>

      <div id="albumList" class="flex flex-wrap gap-4 mb-6"></div>

      <hr class="my-4">

      <div id="masonry" class="masonry"></div>
    </section>



    <!-- Membros (admin only) -->
    <section id="membros" class="py-8 mt-6 hidden">
      <h2 class="text-2xl font-bold mb-2">Gerenciar Membros</h2>

      <div class="grid md:grid-cols-2 gap-4">
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold mb-2">Importar membros (.xlsx)</h3>
          <input id="xlsxInput" type="file" accept=".xlsx,.xls" class="mb-2" />
          <button id="importXlsxBtn" class="bg-amber-600 text-white px-3 py-2 rounded mr-2">Importar Excel</button>
          <button id="exportCsvBtn" class="bg-gray-100 px-3 py-2 rounded">Exportar CSV</button>
          <button id="clearMembersBtn" class="bg-red-100 text-red-700 px-3 py-2 rounded ml-2">Limpar (local)</button>
          <p class="text-xs text-gray-500 mt-2">Planilha: Nome, Email, CPF, Telefone, Endereco, DataNascimento</p>
        </div>

        <form id="memberForm" class="bg-white p-4 rounded shadow space-y-2">
          <h3 class="font-semibold">Adicionar membro</h3>
          <input id="mName" placeholder="Nome completo" class="w-full p-2 border rounded" required />
          <input id="mEmail" type="email" placeholder="E-mail" class="w-full p-2 border rounded" required />
          <input id="mCPF" placeholder="CPF" class="w-full p-2 border rounded" required />
          <input id="mPhone" placeholder="Telefone" class="w-full p-2 border rounded" required />
          <input id="mAddress" placeholder="Endereço" class="w-full p-2 border rounded" required />
          <input id="mBirth" type="date" class="w-full p-2 border rounded" required />
          <div class="flex gap-2">
            <button type="submit" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button>
          </div>
        </form>
      </div>

      <div class="mt-4 bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">Lista de membros</h3>
        <div id="membersList" class="max-h-64 overflow-auto space-y-2"></div>
      </div>
    </section>

  

    <!-- Aniversariantes -->
    <section id="aniversariantes" class="py-8 mt-6 bg-white p-6 rounded shadow">
      <h2 class="text-2xl font-bold mb-2">Aniversariantes do mês</h2>
      <div id="birthdayList" class="space-y-2"></div>
    </section>

    <!-- Contato -->
    <section id="contato" class="py-16">
      <div class="container mx-auto px-6">
         <h2 class="text-2xl font-bold mb-2">Visite-nos</h2>
        <p class="section-subtitle">Será uma alegria receber você e sua família.</p>
        <div class="grid md:grid-cols-2 gap-6 items-center">
          <div class="h-80 rounded-2xl overflow-hidden">
            <iframe src="https://maps.google.com/maps?q=Rua%2059%2C%2045%20Olaria%202%2C%20Tim%C3%B3teo%20MG&t=&z=17&ie=UTF8&iwloc=&output=embed" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
          </div>
          <div>
            <div class="bg-white p-6 rounded-2xl shadow-xl">
              <h3 class="font-bold text-2xl mb-2">IEQ Olaria II</h3>
              <p class="text-gray-600 mb-2"><i class="fas fa-map-marker-alt mr-2 text-blue-600"></i>Rua 59, nº 45 - Olaria 2, Timóteo - MG</p>
              <p class="text-gray-600 mb-2"><i class="fas fa-phone mr-2 text-blue-600"></i>(31) 3848-2880</p>
              <a href="https://www.instagram.com/ieqolaria2/" target="_blank" class="text-pink-600 font-semibold">@ieqolaria2</a>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Modals root -->
  <div id="modalRoot" class="hidden"></div>

  <!-- Admin badge visible -->
  <div id="adminBadgeFloat" class="admin-badge">ADMIN</div>

  <!-- Scripts -->
  <script>
  /*************************************************************************
   * Config
   **************************************************************************/
  const ADMIN_PASSWORD = 'admin123'; // altere aqui se desejar
  const STORAGE_ALBUMS = 'ieq_albums';
  const STORAGE_MEMBERS = 'ieq_members';
  const STORAGE_PROGRAM = 'ieq_program';

  /*************************************************************************
   * Helpers
   **************************************************************************/
  function readJSON(key){ try{ return JSON.parse(localStorage.getItem(key) || '[]'); } catch(e){ return []; } }
  function writeJSON(key, value){ localStorage.setItem(key, JSON.stringify(value)); }
  function formatBR(iso){ if(!iso) return ''; const d=new Date(iso); if(isNaN(d)) return iso; return d.toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric'}); }

  /*************************************************************************
   * Admin UI handling (login, logout)
   **************************************************************************/
  const loginModal = document.getElementById('loginModal');
  const adminPasswordInput = document.getElementById('adminPasswordInput');
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminCloseBtn = document.getElementById('adminCloseBtn');
  const adminBadge = document.getElementById('adminBadge');
  const navMembros = document.getElementById('navMembros');
  const mobileNavMembros = document.getElementById('mobileNavMembros');
  const albumsAdminControls = document.getElementById('albumsAdminControls');
  const membersSection = document.getElementById('membros');
  const programAdminControls = document.getElementById('programAdminControls');

  let isAdmin = false;
  function setAdminMode(on){
    isAdmin = !!on;
    // show/hide elements
    document.getElementById('albumsAdminControls')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('btnCreateAlbum')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('btnSampleAlbums')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('navMembros')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('mobileNavMembros')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('membros')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('albumsAdminControls')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('programAdminControls')?.classList.toggle('hidden', !isAdmin);
    document.getElementById('adminBadgeFloat').style.display = isAdmin ? 'block' : 'none';
  }

  adminLoginBtn.addEventListener('click', ()=>{
    const pw = adminPasswordInput.value || '';
    if(pw === ADMIN_PASSWORD){
      setAdminMode(true);
      loginModal.classList.add('hidden');
      renderAll();
      alert('Modo admin ativado.');
    } else alert('Senha incorreta.');
  });
  adminCloseBtn.addEventListener('click', ()=> loginModal.classList.add('hidden'));
  document.getElementById('btnAdminLogout')?.addEventListener('click', ()=>{
    setAdminMode(false);
    alert('Logout do admin realizado.');
  });

  // mobile menu toggle
  document.getElementById('mobileMenuBtn').addEventListener('click', ()=> document.getElementById('mobileMenu').classList.toggle('hidden'));

  /*************************************************************************
   * Modal helpers
   **************************************************************************/
  const modalRoot = document.getElementById('modalRoot');
  function showModal(innerHTML){
    modalRoot.innerHTML = `<div class="modal-backdrop" id="modalBackdrop"><div class="modal-content relative">${innerHTML}<button id="modalClose" class="absolute top-3 right-3 text-gray-600"><i class="fas fa-times fa-lg"></i></button></div></div>`;
    modalRoot.classList.remove('hidden');
    document.getElementById('modalClose').addEventListener('click', hideModal);
    document.getElementById('modalBackdrop').addEventListener('click', (e)=> { if(e.target.id==='modalBackdrop') hideModal(); });
  }
  function hideModal(){ modalRoot.innerHTML=''; modalRoot.classList.add('hidden'); }

  /*************************************************************************
   * ALBUMS CRUD
   **************************************************************************/
  const albumListEl = document.getElementById('albumList');
  const masonryEl = document.getElementById('masonry');
  const btnCreateAlbum = document.getElementById('btnCreateAlbum');
  const btnSampleAlbums = document.getElementById('btnSampleAlbums');

  function loadAlbums(){ return readJSON(STORAGE_ALBUMS); }
  function saveAlbums(list){ writeJSON(STORAGE_ALBUMS, list); }

  function renderAlbums(){
    const albums = loadAlbums();
    albumListEl.innerHTML = '';
    masonryEl.innerHTML = '';
    if(!albums.length) albumListEl.innerHTML = '<div class="p-4 text-gray-600">Nenhum álbum criado.</div>';
    albums.forEach((a, idx) => {
      const cover = (a.photos && a.photos.length) ? a.photos[0].url : 'https://via.placeholder.com/400x240?text=Álbum';
      // album card
      const card = document.createElement('div');
      card.className = 'album-card';
      card.innerHTML = `<img src="${cover}" alt="${a.title}"><div class="album-title p-3">${a.title}<div class="text-sm text-gray-500 font-normal">${formatBR(a.date)} • ${(a.photos||[]).length} foto(s)</div></div>`;
      card.addEventListener('click', ()=> openAlbum(idx));
      albumListEl.appendChild(card);
      // show all photos in masonry (optional: show recent photos globally)
      // we will populate masonry when album opened; for now show recent photos across albums
    });
  }

  function openAlbum(index){
    const albums = loadAlbums();
    const album = albums[index];
    if(!album) return;
    // Build modal content with photos and admin controls (edit/delete)
    let html = `<div class="p-4"><h3 class="text-2xl font-bold mb-2">${album.title}</h3><p class="text-sm text-gray-600 mb-4">${formatBR(album.date)}</p>`;
    if(isAdmin){
      html += `<div class="flex gap-2 mb-4">
        <button id="btnAddPhotos" class="bg-blue-600 text-white px-3 py-2 rounded">Adicionar Fotos</button>
        <button id="btnEditAlbum" class="bg-yellow-100 text-yellow-700 px-3 py-2 rounded">Editar Álbum</button>
        <button id="btnDeleteAlbum" class="bg-red-100 text-red-700 px-3 py-2 rounded">Excluir Álbum</button>
      </div>`;
    }
    // photos grid
    const photosHtml = (album.photos || []).map((p, i) => `<div class="masonry-item"><img src="${p.url}" alt=""><div class="meta">${p.caption || ''}${isAdmin?` <div class='mt-2'><button data-idx='${i}' class='deletePhotoBtn text-red-600 text-sm'>Excluir foto</button></div>`:''}</div></div>`).join('');
    html += `<div class="columns-2 md:columns-3 gap-2">${photosHtml || '<p class="text-gray-600">Nenhuma foto.</p>'}</div>`;
    html += `</div>`;
    showModal(html);

    // bind admin buttons
    if(isAdmin){
      document.getElementById('btnAddPhotos').addEventListener('click', ()=> showAddPhotosModal(index));
      document.getElementById('btnEditAlbum').addEventListener('click', ()=> showEditAlbumModal(index));
      document.getElementById('btnDeleteAlbum').addEventListener('click', ()=>{
        if(!confirm('Excluir álbum?')) return;
        const arr = loadAlbums(); arr.splice(index,1); saveAlbums(arr); renderAlbums(); hideModal();
      });
      // photo delete buttons
      document.querySelectorAll('.deletePhotoBtn').forEach(btn=>{
        btn.addEventListener('click',(e)=>{
          const pidx = parseInt(e.target.dataset.idx,10);
          if(!confirm('Excluir foto?')) return;
          const arr = loadAlbums();
          arr[index].photos.splice(pidx,1);
          saveAlbums(arr);
          openAlbum(index); // refresh modal
        });
      });
    }
  }

  // create album via modal (title + date)
  btnCreateAlbum?.addEventListener('click', ()=>{
    if(!isAdmin){ alert('Somente admin'); return; }
    showModal(`<div class="p-4">
      <h3 class="text-xl font-bold mb-2">Criar Álbum</h3>
      <input id="newAlbumTitle" placeholder="Título do álbum" class="w-full p-2 border rounded mb-2"/>
      <input id="newAlbumDate" type="date" class="w-full p-2 border rounded mb-4"/>
      <div class="flex gap-2"><button id="saveNewAlbum" class="bg-green-600 text-white px-3 py-2 rounded">Criar</button><button id="cancelNewAlbum" class="bg-gray-100 px-3 py-2 rounded">Cancelar</button></div>
    </div>`);
    document.getElementById('cancelNewAlbum').addEventListener('click', hideModal);
    document.getElementById('saveNewAlbum').addEventListener('click', ()=>{
      const title = document.getElementById('newAlbumTitle').value.trim();
      const date = document.getElementById('newAlbumDate').value || new Date().toISOString();
      if(!title){ alert('Informe título'); return; }
      const arr = loadAlbums();
      arr.push({ title, date, photos: [] });
      saveAlbums(arr); renderAlbums(); hideModal(); alert('Álbum criado');
    });
  });

  // edit album
  function showEditAlbumModal(index){
    const arr = loadAlbums(); const a = arr[index];
    showModal(`<div class="p-4">
      <h3 class="text-xl font-bold mb-2">Editar Álbum</h3>
      <input id="editAlbumTitle" value="${(a.title||'').replace(/"/g,'&quot;')}" class="w-full p-2 border rounded mb-2"/>
      <input id="editAlbumDate" type="date" value="${a.date? a.date.split('T')[0] : ''}" class="w-full p-2 border rounded mb-4"/>
      <div class="flex gap-2"><button id="saveEditAlbum" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button><button id="cancelEditAlbum" class="bg-gray-100 px-3 py-2 rounded">Cancelar</button></div>
    </div>`);
    document.getElementById('cancelEditAlbum').addEventListener('click', hideModal);
    document.getElementById('saveEditAlbum').addEventListener('click', ()=>{
      const title = document.getElementById('editAlbumTitle').value.trim();
      const date = document.getElementById('editAlbumDate').value || a.date;
      if(!title) { alert('Título obrigatório'); return; }
      arr[index].title = title; arr[index].date = date;
      saveAlbums(arr); renderAlbums(); hideModal(); alert('Álbum atualizado');
    });
  }

  // add multiple photos to album
  function showAddPhotosModal(albumIndex){
    showModal(`<div class="p-4">
      <h3 class="text-xl font-bold mb-2">Adicionar várias fotos</h3>
      <input id="photosFiles" type="file" accept="image/*" multiple class="w-full mb-2"/>
      <input id="photosCaption" placeholder="Legenda comum (opcional)" class="w-full p-2 border rounded mb-3"/>
      <div class="flex gap-2"><button id="sendPhotosBtn" class="bg-green-600 text-white px-3 py-2 rounded">Enviar</button><button id="cancelPhotos" class="bg-gray-100 px-3 py-2 rounded">Cancelar</button></div>
    </div>`);
    document.getElementById('cancelPhotos').addEventListener('click', hideModal);
    document.getElementById('sendPhotosBtn').addEventListener('click', async ()=>{
      const filesEl = document.getElementById('photosFiles');
      const caption = document.getElementById('photosCaption').value.trim();
      if(!filesEl.files || filesEl.files.length===0){ alert('Selecione imagens'); return; }
      const arr = loadAlbums();
      if(!arr[albumIndex]){ alert('Álbum não encontrado'); hideModal(); return; }
      const files = Array.from(filesEl.files);
      const urls = await Promise.all(files.map(f=>fileToDataURL(f)));
      urls.forEach(u => arr[albumIndex].photos.push({ url:u, caption }));
      saveAlbums(arr); hideModal(); openAlbum(albumIndex);
    });
  }

  function fileToDataURL(file){ return new Promise((res, rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsDataURL(file); }); }

  // sample albums
  btnSampleAlbums?.addEventListener('click', ()=>{
    if(!isAdmin){ alert('Somente admin'); return; }
    const sample = [
      { title:'Culto de Domingo', date:new Date().toISOString(), photos:[ {url:'https://picsum.photos/800/600?random=101', caption:'Louvor'}, {url:'https://picsum.photos/600/800?random=102', caption:'Oração'} ] },
      { title:'Acampamento', date:new Date().toISOString(), photos:[ {url:'https://picsum.photos/700/700?random=111', caption:'Fogueira'} ] }
    ];
    saveAlbums(sample); renderAlbums(); alert('Álbuns de exemplo adicionados.');
  });

  /*************************************************************************
   * PROGRAM (CRUD) - option B: day, time, description
   **************************************************************************/
  const programListEl = document.getElementById('programList');
  const btnCreateProgram = document.getElementById('btnCreateProgram');

  function loadProgram(){ return readJSON(STORAGE_PROGRAM); }
  function saveProgram(list){ writeJSON(STORAGE_PROGRAM, list); }

  function renderProgram(){
    const list = loadProgram();
    programListEl.innerHTML = '';
    if(!list.length) programListEl.innerHTML = '<div class="p-4 text-gray-600">Nenhum evento na programação.</div>';
    list.forEach((ev, idx)=> {
      const card = document.createElement('div');
      card.className = 'bg-white p-4 rounded shadow';
      card.innerHTML = `<div class="flex justify-between items-start"><div><div class="font-bold">${ev.day} • ${ev.time}</div><div class="text-gray-700 mt-1">${ev.title}</div><div class="text-sm text-gray-500 mt-1">${ev.description}</div></div><div>${isAdmin? `<button data-idx="${idx}" class="editProgBtn text-yellow-600 mr-2">Editar</button><button data-idx="${idx}" class="deleteProgBtn text-red-600">Excluir</button>` : ''}</div></div>`;
      programListEl.appendChild(card);
    });
    // bind admin buttons
    document.querySelectorAll('.editProgBtn').forEach(btn=> btn.addEventListener('click', e=>{
      const idx = parseInt(e.target.dataset.idx,10);
      showEditProgramModal(idx);
    }));
    document.querySelectorAll('.deleteProgBtn').forEach(btn=> btn.addEventListener('click', e=>{
      const idx = parseInt(e.target.dataset.idx,10);
      if(!confirm('Excluir evento?')) return;
      const arr = loadProgram(); arr.splice(idx,1); saveProgram(arr); renderProgram();
    }));
  }
  function loginAdmin() {
  const senha = document.getElementById("adminPassword").value;
  if (senha === senhaCorreta) {

    isAdmin = true;

    // Oculta completamente o modal
    const modal = document.getElementById("loginModal");
    modal.classList.add("hidden");
    modal.style.display = "none";

    // Mostra menus do admin
    document.getElementById("menuAdminMembros").classList.remove("hidden");
    document.getElementById("menuAdminAlbuns").classList.remove("hidden");
    document.getElementById("programacaoAdmin").classList.remove("hidden");

  } else {
    alert("Senha incorreta.");
  }
}


  btnCreateProgram?.addEventListener('click', ()=>{
    if(!isAdmin){ alert('Somente admin'); return; }
    showModal(`<div class="p-4">
      <h3 class="text-xl font-bold mb-2">Criar Evento</h3>
      <select id="progDay" class="w-full p-2 border rounded mb-2">
        <option>Segunda</option><option>Terça</option><option>Quarta</option><option>Quinta</option><option>Sexta</option><option>Sábado</option><option>Domingo</option>
      </select>
      <input id="progTime" type="time" class="w-full p-2 border rounded mb-2"/>
      <input id="progTitle" placeholder="Título" class="w-full p-2 border rounded mb-2"/>
      <textarea id="progDesc" placeholder="Descrição" class="w-full p-2 border rounded mb-2"></textarea>
      <div class="flex gap-2"><button id="saveProgBtn" class="bg-green-600 text-white px-3 py-2 rounded">Salvar</button><button id="cancelProg" class="bg-gray-100 px-3 py-2 rounded">Cancelar</button></div>
    </div>`);
    document.getElementById('cancelProg').addEventListener('click', hideModal);
    document.getElementById('saveProgBtn').addEventListener('click', ()=>{
      const day = document.getElementById('progDay').value;
      const time = document.getElementById('progTime').value;
      const title = document.getElementById('progTitle').value.trim();
      const description = document.getElementById('progDesc').value.trim();
      if(!day || !time || !title){ alert('Preencha dia, horário e título'); return; }
      const arr = loadProgram();
      arr.push({ day, time, title, description });
      saveProgram(arr); renderProgram(); hideModal(); alert('Evento criado');
    });
  });

  function showEditProgramModal(index){
    if(!isAdmin) return;
    const arr = loadProgram(); const ev = arr[index];
    showModal(`<div class="p-4">
      <h3 class="text-xl font-bold mb-2">Editar Evento</h3>
      <select id="editProgDay" class="w-full p-2 border rounded mb-2">
        <option ${ev.day==='Segunda'?'selected':''}>Segunda</option><option ${ev.day==='Terça'?'selected':''}>Terça</option><option ${ev.day==='Quarta'?'selected':''}>Quarta</option><option ${ev.day==='Quinta'?'selected':''}>Quinta</option><option ${ev.day==='Sexta'?'selected':''}>Sexta</option><option ${ev.day==='Sábado'?'selected':''}>Sábado</option><option ${ev.day==='Domingo'?'selected':''}>Domingo</option>
      </select>
      <input id="editProgTime" type="time" value="${ev.time||''}" class="w-full p-2 border rounded mb-2"/>
      <input id="editProgTitle" value="${(ev.title||'').replace(/"/g,'&quot;')}" class="w-full p-2 border rounded mb-2"/>
      <textarea id="editProgDesc" class="w-full p-2 border rounded mb-2">${(ev.description||'').replace(/</g,'&lt;')}</textarea>
      <div class="flex gap-2"><button id="saveEditProg" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button><button id="cancelEditProg" class="bg-gray-100 px-3 py-2 rounded">Cancelar</button></div>
    </div>`);
    document.getElementById('cancelEditProg').addEventListener('click', hideModal);
    document.getElementById('saveEditProg').addEventListener('click', ()=>{
      const day = document.getElementById('editProgDay').value;
      const time = document.getElementById('editProgTime').value;
      const title = document.getElementById('editProgTitle').value.trim();
      const description = document.getElementById('editProgDesc').value.trim();
      if(!day||!time||!title){ alert('Preencha campos'); return; }
      arr[index] = { day, time, title, description };
      saveProgram(arr); renderProgram(); hideModal();
    });
  }

  /*************************************************************************
   * MEMBERS CRUD + Excel import + Export CSV
   **************************************************************************/
  const membersListEl = document.getElementById('membersList');
  const memberForm = document.getElementById('memberForm');
  const xlsxInput = document.getElementById('xlsxInput');
  const importXlsxBtn = document.getElementById('importXlsxBtn');
  const exportCsvBtn = document.getElementById('exportCsvBtn');
  const clearMembersBtn = document.getElementById('clearMembersBtn');

  function loadMembers(){ return readJSON(STORAGE_MEMBERS); }
  function saveMembers(list){ writeJSON(STORAGE_MEMBERS, list); }

  function renderMembers(){
    const list = loadMembers();
    membersListEl.innerHTML = '';
    if(!list.length) membersListEl.innerHTML = '<div class="p-3 text-gray-600">Nenhum membro cadastrado.</div>';
    list.forEach((m, idx)=>{
      const div = document.createElement('div'); div.className='p-3 rounded bg-white shadow flex justify-between items-start';
      div.innerHTML = `<div><strong>${m.Nome||m.name}</strong><div class="text-sm text-gray-600">${m.Email||m.email} • ${m.Telefone||m.telefone||m.phone||''}</div><div class="text-sm mt-1 text-gray-700">${m.Endereco||m.endereco||''} • ${m.DataNascimento||m.data||''}</div></div><div><button data-idx="${idx}" class="editMemberBtn text-yellow-600 mr-2">Editar</button><button data-idx="${idx}" class="deleteMemberBtn text-red-600">Excluir</button></div>`;
      membersListEl.appendChild(div);
    });
    // bind buttons
    document.querySelectorAll('.deleteMemberBtn').forEach(btn=> btn.addEventListener('click', e=>{
      const idx = parseInt(e.target.dataset.idx,10);
      if(!confirm('Remover membro?')) return;
      const arr = loadMembers(); arr.splice(idx,1); saveMembers(arr); renderMembers(); renderBirthdays();
    }));
    document.querySelectorAll('.editMemberBtn').forEach(btn=> btn.addEventListener('click', e=>{
      const idx = parseInt(e.target.dataset.idx,10); showEditMemberModal(idx);
    }));
    renderBirthdays();
  }

  // add member via form
  memberForm?.addEventListener('submit', (ev)=>{
    ev.preventDefault();
    const name = document.getElementById('mName').value.trim();
    const email = document.getElementById('mEmail').value.trim();
    const cpf = document.getElementById('mCPF').value.trim();
    const phone = document.getElementById('mPhone').value.trim();
    const address = document.getElementById('mAddress').value.trim();
    const birth = document.getElementById('mBirth').value;
    if(!name||!email||!cpf||!phone||!address||!birth){ alert('Preencha todos os campos'); return; }
    const arr = loadMembers(); arr.push({ Nome:name, Email:email, CPF:cpf, Telefone:phone, Endereco:address, DataNascimento:birth }); saveMembers(arr); memberForm.reset(); renderMembers(); alert('Membro salvo.');
  });

  // edit member modal
  function showEditMemberModal(index){
    const arr = loadMembers(); const m = arr[index];
    showModal(`<div class="p-4">
      <h3 class="text-xl font-bold mb-2">Editar Membro</h3>
      <input id="editMName" class="w-full p-2 border rounded mb-2" value="${(m.Nome||'').replace(/"/g,'&quot;')}"/>
      <input id="editMEmail" class="w-full p-2 border rounded mb-2" value="${(m.Email||'').replace(/"/g,'&quot;')}"/>
      <input id="editMCPF" class="w-full p-2 border rounded mb-2" value="${(m.CPF||'').replace(/"/g,'&quot;')}"/>
      <input id="editMPhone" class="w-full p-2 border rounded mb-2" value="${(m.Telefone||'').replace(/"/g,'&quot;')}"/>
      <input id="editMAddress" class="w-full p-2 border rounded mb-2" value="${(m.Endereco||'').replace(/"/g,'&quot;')}"/>
      <input id="editMBirth" type="date" class="w-full p-2 border rounded mb-2" value="${(m.DataNascimento||'').split('T')[0]||''}"/>
      <div class="flex gap-2"><button id="saveEditMember" class="bg-blue-600 text-white px-3 py-2 rounded">Salvar</button><button id="cancelEditMember" class="bg-gray-100 px-3 py-2 rounded">Cancelar</button></div>
    </div>`);
    document.getElementById('cancelEditMember').addEventListener('click', hideModal);
    document.getElementById('saveEditMember').addEventListener('click', ()=>{
      const name = document.getElementById('editMName').value.trim();
      const email = document.getElementById('editMEmail').value.trim();
      const cpf = document.getElementById('editMCPF').value.trim();
      const phone = document.getElementById('editMPhone').value.trim();
      const address = document.getElementById('editMAddress').value.trim();
      const birth = document.getElementById('editMBirth').value;
      if(!name||!email||!cpf||!phone||!address||!birth){ alert('Preencha todos os campos'); return; }
      arr[index] = { Nome:name, Email:email, CPF:cpf, Telefone:phone, Endereco:address, DataNascimento:birth };
      saveMembers(arr); hideModal(); renderMembers(); renderBirthdays();
    });
  }

  // Excel import
  importXlsxBtn?.addEventListener('click', ()=>{
    const file = xlsxInput.files && xlsxInput.files[0]; if(!file){ alert('Selecione arquivo .xlsx'); return; }
    const fr = new FileReader();
    fr.onload = function(e){
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type:'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const rows = XLSX.utils.sheet_to_json(sheet, { defval:'' });
      if(!rows.length) { alert('Planilha vazia'); return; }
      const mapped = rows.map(r => ({
        Nome: r.Nome || r.nome || r.Name || r.name || '',
        Email: r.Email || r.email || '',
        CPF: r.CPF || r.cpf || '',
        Telefone: r.Telefone || r.telefone || r.Phone || r.phone || '',
        Endereco: r.Endereco || r.endereco || r.Address || r.address || '',
        DataNascimento: r.DataNascimento || r.dataNascimento || r.data || r.DataNascimento || ''
      }));
      const existing = loadMembers(); const combined = existing.concat(mapped);
      saveMembers(combined); renderMembers(); alert(`Importados ${mapped.length} membros.`);
    };
    fr.readAsArrayBuffer(file);
  });

  // export CSV
  exportCsvBtn?.addEventListener('click', ()=>{
    const members = loadMembers(); if(!members.length) { alert('Nenhum membro'); return; }
    const header = ['Nome','Email','CPF','Telefone','Endereco','DataNascimento'];
    const rows = members.map(m => [m.Nome||'', m.Email||'', m.CPF||'', m.Telefone||'', m.Endereco||'', m.DataNascimento||'']);
    const csv = [header, ...rows].map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' }); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'membros.csv'; a.click(); URL.revokeObjectURL(url);
  });

  // clear members
  clearMembersBtn?.addEventListener('click', ()=> {
    if(!confirm('Apagar TODOS os membros (localStorage)?')) return;
    localStorage.removeItem(STORAGE_MEMBERS); renderMembers(); renderBirthdays();
  });

  /*************************************************************************
   * Birthdays (visible to all)
   **************************************************************************/
  const birthdayListEl = document.getElementById('birthdayList');
  function renderBirthdays(){
    const members = loadMembers();
    const month = new Date().getMonth();
    const birthdays = members.filter(m => {
      const d = new Date(m.DataNascimento || m.data || '');
      return !isNaN(d) && d.getMonth() === month;
    });
    birthdayListEl.innerHTML = '';
    if(!birthdays.length){ birthdayListEl.innerHTML = '<p class="text-gray-600">Não há aniversariantes este mês.</p>'; return; }
    birthdays.sort((a,b)=> new Date(a.DataNascimento || a.data) - new Date(b.DataNascimento || b.data));
    birthdays.forEach(b=>{
      const d = new Date(b.DataNascimento || b.data); const day = d.getDate(); const monthName = d.toLocaleString('pt-BR',{month:'long'});
      const el = document.createElement('div'); el.className='p-3 rounded bg-gray-50 flex justify-between'; el.innerHTML = `<div><strong>${b.Nome||b.name}</strong><div class="text-sm text-gray-600">${b.Email||''} • ${b.Telefone||''}</div></div><div class="text-sm">${day} de ${monthName}</div>`;
      birthdayListEl.appendChild(el);
    });
  }

  /*************************************************************************
   * Utils & Init
   **************************************************************************/
  // open album function exposed (if needed)
  window.openAlbum = openAlbum;

  function renderAll(){
    renderAlbums(); renderProgram(); renderMembers(); renderBirthdays();
  }

  // initial sample data (only if no data)
  (function seedIfEmpty(){
    if(!readJSON(STORAGE_ALBUMS).length) {
      // no seed by default - admin can add sample via button
    }
    if(!readJSON(STORAGE_PROGRAM).length) {
      const sampleProg = [
        { day:'Domingo', time:'08:00', title:'Culto de Domingo', description:'Louvor e Palavra' },
        { day:'Quarta', time:'19:30', title:'Quarta de Oração', description:'Tempo de busca' }
      ];
      writeJSON(STORAGE_PROGRAM, sampleProg);
    }
    if(!readJSON(STORAGE_MEMBERS).length) {
      // do not seed members (avoid dummy Ana)
    }
  })();

  // initial render
  window.addEventListener('load', ()=> { setAdminMode(false); renderAll(); });

  // logout button
  document.getElementById('btnAdminLogout')?.addEventListener('click', ()=>{
    setAdminMode(false); alert('Logout efetuado'); location.reload();
  });

  </script>
</body>
</html>
